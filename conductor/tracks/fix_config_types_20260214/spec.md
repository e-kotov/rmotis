# Specification: fix_config_types_20260214

## Overview
The function `rmotis::motis_configure_server()` currently generates YAML configurations where numeric values may be written as floating-point numbers (e.g., `n_threads: 16.0`, `port: 11209.0`). The MOTIS backend (specifically `yaml-cpp`) fails to parse these fields when an integer is strictly expected, leading to server start failures. This track will implement robust type validation and casting to ensure generated YAML is always correctly typed.

## Functional Requirements
- **Strict Integer Casting:** Implement an internal mapping of fields known to require integers (e.g., `n_threads`, `port`, `db_size`, `*_results`, `update_interval`).
- **Heuristic Cleanup:** Implement a global "defensive casting" check that converts any numeric value with no decimal component (e.g., `x == floor(x)`) into an R integer type before YAML serialization.
- **Input Preservation:** Ensure that legitimate floating-point values (like `max_matching_distance: 25.0` or other coordinate-related settings) are preserved if they actually contain decimal information.
- **Validation:** Add basic range checks for critical fields (e.g., `port` must be between 1 and 65535, `n_threads` must be positive).

## Non-Functional Requirements
- **Idiomatic R:** Use `rlang` or base R patterns consistent with the existing codebase for list manipulation.
- **Performance:** Casting should happen just before writing the YAML to minimize overhead during configuration building.

## Acceptance Criteria
- Running `motis_configure_server()` with numeric arguments (e.g., `port = 8080`) results in a YAML file containing `port: 8080` (integer) instead of `port: 8080.0`.
- The MOTIS server successfully starts using a configuration generated with numeric-but-integer-valued inputs.
- Unit tests verify that both "mapped" fields and "unmapped" integer-valued fields are correctly converted.
- Unit tests verify that legitimate doubles (e.g., `25.5`) remain doubles.

## Verification Procedure
Instead of manual verification, use the following automated sequence in a test script:
1.  **Configure:** Generate a configuration using `motis_configure_server()` with numeric values.
2.  **Start:** Call `motis_start_server("/Users/ek/Downloads/sweden-local/sweden-motis", motis_path = "/Users/ek/Downloads/sweden-local/bin/motis")`.
3.  **Query:** Send a small request (similar to `local-testing/sweden-centroids.R`) to verify the server is responding.
4.  **Stop:** Call `motis_stop_all(TRUE)` to clean up.

## Out of Scope
- Comprehensive validation of every possible MOTIS configuration key (focusing on the most critical ones identified).
- Changes to the `motis.client` autogenerated code.
