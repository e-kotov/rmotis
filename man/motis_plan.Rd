% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/api_plan.R
\name{motis_plan}
\alias{motis_plan}
\title{Plan a journey between two points or create a travel time matrix}
\usage{
motis_plan(
  from,
  to,
  time = Sys.time(),
  arrive_by = FALSE,
  from_id_col = "id",
  to_id_col = "id",
  ...,
  output = c("itineraries", "legs", "travel_time_matrix_long", "travel_time_matrix_wide",
    "raw_list"),
  parallel = FALSE
)
}
\arguments{
\item{from}{The origin location(s). Can be a character vector of station IDs,
a data frame/tibble with ID or coordinate columns, an \code{sf}
object with POINT geometry, or a numeric matrix (\code{lon}, \code{lat}).}

\item{to}{The destination location(s). Must be of the same type as \code{from}.
For paired journey planning, must be the same length as \code{from}. For
travel time matrix calculation, length can be different.}

\item{time}{The departure or arrival time. Can be a POSIXct object (like from
\code{Sys.time()}) or a character string in ISO 8601 format (e.g., "2025-08-15T15:11:00Z").
Defaults to the current time.}

\item{arrive_by}{Logical. If \code{TRUE}, \code{time} is treated as the arrival time.
Defaults to \code{FALSE} (departure time).}

\item{from_id_col}{The name of the column in \code{from} containing station IDs.
Defaults to \code{"id"}.}

\item{to_id_col}{The name of the column in \code{to} containing station IDs.
Defaults to \code{"id"}.}

\item{...}{
  Arguments passed on to \code{\link[motis.client:mc_plan]{motis.client::mc_plan}}
  \describe{
    \item{\code{via}}{List of via stops to visit (only stop IDs, no coordinates allowed for now).
Also see the optional parameter \code{viaMinimumStay} to set a set a minimum stay duration for each via stop.}
    \item{\code{viaMinimumStay}}{Optional. If not set, the default is \verb{0,0} - no stay required.

For each \code{via} stop a minimum stay duration in minutes.

The value \code{0} signals that it's allowed to stay in the same trip.
This enables via stays without counting a transfer and can lead
to better connections with less transfers. Transfer connections can
still be found with \code{viaMinimumStay=0}.}
    \item{\code{maxTransfers}}{The maximum number of allowed transfers (i.e. interchanges between transit legs,
pre- and postTransit do not count as transfers).
\code{maxTransfers=0} searches for direct transit connections without any transfers.
If you want to search only for non-transit connections (\code{FOOT}, \code{CAR}, etc.),
send an empty \code{transitModes} parameter instead.

If not provided, the routing uses the server-side default value
which is hardcoded and very high to cover all use cases.

\emph{Warning}: Use with care. Setting this too low can lead to
optimal (e.g. the fastest) journeys not being found.
If this value is too low to reach the destination at all,
it can lead to slow routing performance.

In plan endpoints before v3, the behavior is off by one,
i.e. \code{maxTransfers=0} only returns non-transit connections.}
    \item{\code{maxTravelTime}}{The maximum travel time in minutes.
If not provided, the routing to uses the value
hardcoded in the server which is usually quite high.

\emph{Warning}: Use with care. Setting this too low can lead to
optimal (e.g. the least transfers) journeys not being found.
If this value is too low to reach the destination at all,
it can lead to slow routing performance.}
    \item{\code{minTransferTime}}{Optional. Default is 0 minutes.

Minimum transfer time for each transfer in minutes.}
    \item{\code{additionalTransferTime}}{Optional. Default is 0 minutes.

Additional transfer time reserved for each transfer in minutes.}
    \item{\code{transferTimeFactor}}{Optional. Default is 1.0

Factor to multiply minimum required transfer times with.
Values smaller than 1.0 are not supported.}
    \item{\code{maxMatchingDistance}}{Optional. Default is 25 meters.

Maximum matching distance in meters to match geo coordinates to the street network.}
    \item{\code{pedestrianProfile}}{Optional. Default is \code{FOOT}.

Accessibility profile to use for pedestrian routing in transfers
between transit connections, on the first mile, and last mile.

Allowed values: FOOT, WHEELCHAIR.}
    \item{\code{pedestrianSpeed}}{Optional

Average speed for pedestrian routing.}
    \item{\code{cyclingSpeed}}{Optional

Average speed for bike routing.}
    \item{\code{elevationCosts}}{Optional. Default is \code{NONE}.

Set an elevation cost profile, to penalize routes with incline.
\itemize{
\item \code{NONE}: No additional costs for elevations. This is the default behavior
\item \code{LOW}: Add a low cost for increase in elevation and incline along the way. This will prefer routes with less ascent, if small detours are required.
\item \code{HIGH}: Add a high cost for increase in elevation and incline along the way. This will prefer routes with less ascent, if larger detours are required.
}

As using an elevation costs profile will increase the travel duration,
routing through steep terrain may exceed the maximal allowed duration,
causing a location to appear unreachable.
Increasing the maximum travel time for these segments may resolve this issue.

The profile is used for direct routing, on the first mile, and last mile.

Elevation cost profiles are currently used by following street modes:
\itemize{
\item \code{BIKE}
}

Allowed values: NONE, LOW, HIGH.}
    \item{\code{useRoutedTransfers}}{Optional. Default is \code{false}.

Whether to use transfers routed on OpenStreetMap data.}
    \item{\code{detailedTransfers}}{\itemize{
\item true: Compute transfer polylines and step instructions.
\item false: Only return basic information (start time, end time, duration) for transfers.
}}
    \item{\code{joinInterlinedLegs}}{Optional. Default is \code{true}.

Controls if a journey section with stay-seated transfers is returned:
\itemize{
\item \code{joinInterlinedLegs=false}: as several legs (full information about all trip numbers, headsigns, etc.).
Legs that do not require a transfer (stay-seated transfer) are marked with \code{interlineWithPreviousLeg=true}.
\item \code{joinInterlinedLegs=true} (default behavior): as only one joined leg containing all stops
}}
    \item{\code{transitModes}}{Optional. Default is \code{TRANSIT} which allows all transit modes (no restriction).
Allowed modes for the transit part. If empty, no transit connections will be computed.
For example, this can be used to allow only \verb{SUBURBAN,SUBWAY,TRAM}.

Allowed values: WALK, BIKE, RENTAL, CAR, CAR_PARKING, CAR_DROPOFF, ODM, RIDE_SHARING, FLEX, TRANSIT, TRAM, SUBWAY, FERRY, AIRPLANE, BUS, COACH, RAIL, HIGHSPEED_RAIL, LONG_DISTANCE, NIGHT_RAIL, REGIONAL_FAST_RAIL, REGIONAL_RAIL, SUBURBAN, FUNICULAR, AERIAL_LIFT, OTHER, AREAL_LIFT, METRO, CABLE_CAR.}
    \item{\code{directModes}}{Optional. Default is \code{WALK} which will compute walking routes as direct connections.

Modes used for direction connections from start to destination without using transit.
Results will be returned on the \code{direct} key.

Note: Direct connections will only be returned on the first call. For paging calls, they can be omitted.

Note: Transit connections that are slower than the fastest direct connection will not show up.
This is being used as a cut-off during transit routing to speed up the search.
To prevent this, it's possible to send two separate requests (one with only \code{transitModes} and one with only \code{directModes}).

Note: the output \code{direct} array will stay empty if the input param \code{maxDirectTime} makes any direct trip impossible.

Only non-transit modes such as \code{WALK}, \code{BIKE}, \code{CAR}, \code{BIKE_SHARING}, etc. can be used.

Allowed values: WALK, BIKE, RENTAL, CAR, CAR_PARKING, CAR_DROPOFF, ODM, RIDE_SHARING, FLEX, TRANSIT, TRAM, SUBWAY, FERRY, AIRPLANE, BUS, COACH, RAIL, HIGHSPEED_RAIL, LONG_DISTANCE, NIGHT_RAIL, REGIONAL_FAST_RAIL, REGIONAL_RAIL, SUBURBAN, FUNICULAR, AERIAL_LIFT, OTHER, AREAL_LIFT, METRO, CABLE_CAR.}
    \item{\code{preTransitModes}}{Optional. Default is \code{WALK}. Only applies if the \code{from} place is a coordinate (not a transit stop). Does not apply to direct connections (see \code{directModes}).

A list of modes that are allowed to be used from the \code{from} coordinate to the first transit stop. Example: \verb{WALK,BIKE_SHARING}.

Allowed values: WALK, BIKE, RENTAL, CAR, CAR_PARKING, CAR_DROPOFF, ODM, RIDE_SHARING, FLEX, TRANSIT, TRAM, SUBWAY, FERRY, AIRPLANE, BUS, COACH, RAIL, HIGHSPEED_RAIL, LONG_DISTANCE, NIGHT_RAIL, REGIONAL_FAST_RAIL, REGIONAL_RAIL, SUBURBAN, FUNICULAR, AERIAL_LIFT, OTHER, AREAL_LIFT, METRO, CABLE_CAR.}
    \item{\code{postTransitModes}}{Optional. Default is \code{WALK}. Only applies if the \code{to} place is a coordinate (not a transit stop). Does not apply to direct connections (see \code{directModes}).

A list of modes that are allowed to be used from the last transit stop to the \code{to} coordinate. Example: \verb{WALK,BIKE_SHARING}.

Allowed values: WALK, BIKE, RENTAL, CAR, CAR_PARKING, CAR_DROPOFF, ODM, RIDE_SHARING, FLEX, TRANSIT, TRAM, SUBWAY, FERRY, AIRPLANE, BUS, COACH, RAIL, HIGHSPEED_RAIL, LONG_DISTANCE, NIGHT_RAIL, REGIONAL_FAST_RAIL, REGIONAL_RAIL, SUBURBAN, FUNICULAR, AERIAL_LIFT, OTHER, AREAL_LIFT, METRO, CABLE_CAR.}
    \item{\code{directRentalFormFactors}}{Experimental. Expect unannounced breaking changes (without version bumps).

Optional. Only applies to direct connections.

A list of vehicle type form factors that are allowed to be used for direct connections.
If empty (the default), all form factors are allowed.
Example: \verb{BICYCLE,SCOOTER_STANDING}.

Allowed values: BICYCLE, CARGO_BICYCLE, CAR, MOPED, SCOOTER_STANDING, SCOOTER_SEATED, OTHER.}
    \item{\code{preTransitRentalFormFactors}}{Experimental. Expect unannounced breaking changes (without version bumps).

Optional. Only applies if the \code{from} place is a coordinate (not a transit stop). Does not apply to direct connections (see \code{directRentalFormFactors}).

A list of vehicle type form factors that are allowed to be used from the \code{from} coordinate to the first transit stop.
If empty (the default), all form factors are allowed.
Example: \verb{BICYCLE,SCOOTER_STANDING}.

Allowed values: BICYCLE, CARGO_BICYCLE, CAR, MOPED, SCOOTER_STANDING, SCOOTER_SEATED, OTHER.}
    \item{\code{postTransitRentalFormFactors}}{Experimental. Expect unannounced breaking changes (without version bumps).

Optional. Only applies if the \code{to} place is a coordinate (not a transit stop). Does not apply to direct connections (see \code{directRentalFormFactors}).

A list of vehicle type form factors that are allowed to be used from the last transit stop to the \code{to} coordinate.
If empty (the default), all form factors are allowed.
Example: \verb{BICYCLE,SCOOTER_STANDING}.

Allowed values: BICYCLE, CARGO_BICYCLE, CAR, MOPED, SCOOTER_STANDING, SCOOTER_SEATED, OTHER.}
    \item{\code{directRentalPropulsionTypes}}{Experimental. Expect unannounced breaking changes (without version bumps).

Optional. Only applies to direct connections.

A list of vehicle type form factors that are allowed to be used for direct connections.
If empty (the default), all propulsion types are allowed.
Example: \verb{HUMAN,ELECTRIC,ELECTRIC_ASSIST}.

Allowed values: HUMAN, ELECTRIC_ASSIST, ELECTRIC, COMBUSTION, COMBUSTION_DIESEL, HYBRID, PLUG_IN_HYBRID, HYDROGEN_FUEL_CELL.}
    \item{\code{preTransitRentalPropulsionTypes}}{Experimental. Expect unannounced breaking changes (without version bumps).

Optional. Only applies if the \code{from} place is a coordinate (not a transit stop). Does not apply to direct connections (see \code{directRentalPropulsionTypes}).

A list of vehicle propulsion types that are allowed to be used from the \code{from} coordinate to the first transit stop.
If empty (the default), all propulsion types are allowed.
Example: \verb{HUMAN,ELECTRIC,ELECTRIC_ASSIST}.

Allowed values: HUMAN, ELECTRIC_ASSIST, ELECTRIC, COMBUSTION, COMBUSTION_DIESEL, HYBRID, PLUG_IN_HYBRID, HYDROGEN_FUEL_CELL.}
    \item{\code{postTransitRentalPropulsionTypes}}{Experimental. Expect unannounced breaking changes (without version bumps).

Optional. Only applies if the \code{to} place is a coordinate (not a transit stop). Does not apply to direct connections (see \code{directRentalPropulsionTypes}).

A list of vehicle propulsion types that are allowed to be used from the last transit stop to the \code{to} coordinate.
If empty (the default), all propulsion types are allowed.
Example: \verb{HUMAN,ELECTRIC,ELECTRIC_ASSIST}.

Allowed values: HUMAN, ELECTRIC_ASSIST, ELECTRIC, COMBUSTION, COMBUSTION_DIESEL, HYBRID, PLUG_IN_HYBRID, HYDROGEN_FUEL_CELL.}
    \item{\code{directRentalProviders}}{Experimental. Expect unannounced breaking changes (without version bumps).

Optional. Only applies to direct connections.

A list of rental providers that are allowed to be used for direct connections.
If empty (the default), all providers are allowed.}
    \item{\code{directRentalProviderGroups}}{Experimental. Expect unannounced breaking changes (without version bumps).

Optional. Only applies to direct connections.

A list of rental provider groups that are allowed to be used for direct connections.
If empty (the default), all providers are allowed.}
    \item{\code{preTransitRentalProviders}}{Experimental. Expect unannounced breaking changes (without version bumps).

Optional. Only applies if the \code{from} place is a coordinate (not a transit stop). Does not apply to direct connections (see \code{directRentalProviders}).

A list of rental providers that are allowed to be used from the \code{from} coordinate to the first transit stop.
If empty (the default), all providers are allowed.}
    \item{\code{preTransitRentalProviderGroups}}{Experimental. Expect unannounced breaking changes (without version bumps).

Optional. Only applies if the \code{from} place is a coordinate (not a transit stop). Does not apply to direct connections (see \code{directRentalProviderGroups}).

A list of rental provider groups that are allowed to be used from the \code{from} coordinate to the first transit stop.
If empty (the default), all providers are allowed.}
    \item{\code{postTransitRentalProviders}}{Experimental. Expect unannounced breaking changes (without version bumps).

Optional. Only applies if the \code{to} place is a coordinate (not a transit stop). Does not apply to direct connections (see \code{directRentalProviders}).

A list of rental providers that are allowed to be used from the last transit stop to the \code{to} coordinate.
If empty (the default), all providers are allowed.}
    \item{\code{postTransitRentalProviderGroups}}{Experimental. Expect unannounced breaking changes (without version bumps).

Optional. Only applies if the \code{to} place is a coordinate (not a transit stop). Does not apply to direct connections (see \code{directRentalProviderGroups}).

A list of rental provider groups that are allowed to be used from the last transit stop to the \code{to} coordinate.
If empty (the default), all providers are allowed.}
    \item{\code{ignoreDirectRentalReturnConstraints}}{Experimental. Expect unannounced breaking changes (without version bumps).

Optional. Default is \code{false}.

If set to \code{true}, the routing will ignore rental return constraints for direct connections,
allowing the rental vehicle to be parked anywhere.}
    \item{\code{ignorePreTransitRentalReturnConstraints}}{Experimental. Expect unannounced breaking changes (without version bumps).

Optional. Default is \code{false}.

If set to \code{true}, the routing will ignore rental return constraints for the part from the \code{from} coordinate to the first transit stop,
allowing the rental vehicle to be parked anywhere.}
    \item{\code{ignorePostTransitRentalReturnConstraints}}{Experimental. Expect unannounced breaking changes (without version bumps).

Optional. Default is \code{false}.

If set to \code{true}, the routing will ignore rental return constraints for the part from the last transit stop to the \code{to} coordinate,
allowing the rental vehicle to be parked anywhere.}
    \item{\code{numItineraries}}{The minimum number of itineraries to compute.
This is only relevant if \code{timetableView=true}.
The default value is 5.}
    \item{\code{maxItineraries}}{Optional. By default all computed itineraries will be returned

The maximum number of itineraries to compute.
This is only relevant if \code{timetableView=true}.

Note: With the current implementation, setting this to a lower
number will not result in any speedup.

Note: The number of returned itineraries might be slightly higher
than \code{maxItineraries} as there might be several itineraries with
the same departure time but different number of transfers. In order
to not miss any itineraries for paging, either none or all
itineraries with the same departure time have to be returned.}
    \item{\code{pageCursor}}{Use the cursor to go to the next "page" of itineraries.
Copy the cursor from the last response and keep the original request as is.
This will enable you to search for itineraries in the next or previous time-window.}
    \item{\code{timetableView}}{Optional. Default is \code{true}.

Search for the best trip options within a time window.
If true two itineraries are considered optimal
if one is better on arrival time (earliest wins)
and the other is better on departure time (latest wins).
In combination with arriveBy this parameter cover the following use cases:

\code{timetable=false} = waiting for the first transit departure/arrival is considered travel time:
\itemize{
\item \code{arriveBy=true}: event (e.g. a meeting) starts at 10:00 am,
compute the best journeys that arrive by that time (maximizes departure time)
\item \code{arriveBy=false}: event (e.g. a meeting) ends at 11:00 am,
compute the best journeys that depart after that time
}

\code{timetable=true} = optimize "later departure" + "earlier arrival" and give all options over a time window:
\itemize{
\item \code{arriveBy=true}: the time window around \code{date} and \code{time} refers to the arrival time window
\item \code{arriveBy=false}: the time window around \code{date} and \code{time} refers to the departure time window
}}
    \item{\code{searchWindow}}{Optional. Default is 15 minutes which is \code{900}.

The length of the search-window in seconds. Default value 15 minutes.
\itemize{
\item \code{arriveBy=true}: number of seconds between the earliest departure time and latest departure time
\item \code{arriveBy=false}: number of seconds between the earliest arrival time and the latest arrival time
}}
    \item{\code{requireBikeTransport}}{Optional. Default is \code{false}.

If set to \code{true}, all used transit trips are required to allow bike carriage.}
    \item{\code{requireCarTransport}}{Optional. Default is \code{false}.

If set to \code{true}, all used transit trips are required to allow car carriage.}
    \item{\code{maxPreTransitTime}}{Optional. Default is 15min which is \code{900}.
Maximum time in seconds for the first street leg.
Is limited by server config variable \code{street_routing_max_prepost_transit_seconds}.}
    \item{\code{maxPostTransitTime}}{Optional. Default is 15min which is \code{900}.
Maximum time in seconds for the last street leg.
Is limited by server config variable \code{street_routing_max_prepost_transit_seconds}.}
    \item{\code{maxDirectTime}}{Optional. Default is 30min which is \code{1800}.
Maximum time in seconds for direct connections.
Is limited by server config variable \code{street_routing_max_direct_seconds}.}
    \item{\code{fastestDirectFactor}}{Optional. Experimental. Default is \code{1.0}.
Factor with which the duration of the fastest direct non-public-transit connection is multiplied.
Values > 1.0 allow transit connections that are slower than the fastest direct non-public-transit connection to be found.}
    \item{\code{timeout}}{Optional. Query timeout in seconds.}
    \item{\code{passengers}}{Optional. Experimental. Number of passengers (e.g. for ODM or price calculation)}
    \item{\code{luggage}}{Optional. Experimental. Number of luggage pieces; base unit: airline cabin luggage (e.g. for ODM or price calculation)}
    \item{\code{slowDirect}}{Optional. Experimental. Adds overtaken direct public transit connections.}
    \item{\code{fastestSlowDirectFactor}}{Optional.
Factor with which the duration of the fastest slowDirect connection is multiplied.
Values > 1.0 allow connections that are slower than the fastest direct transit connection to be found.
Values < 1.0 will return all slowDirect connections.}
    \item{\code{withFares}}{Optional. Experimental. If set to true, the response will contain fare information.}
    \item{\code{withScheduledSkippedStops}}{Optional. Include intermediate stops where passengers can not alight/board according to schedule.}
    \item{\code{language}}{language tags as used in OpenStreetMap / GTFS
(usually BCP-47 / ISO 639-1, or ISO 639-2 if there's no ISO 639-1)}
    \item{\code{algorithm}}{algorithm to use

Allowed values: RAPTOR, PONG, TB.}
    \item{\code{.return_as}}{A string specifying the return format. Defaults to 'list'. Options are 'list' for a parsed R list, 'raw' for the raw httr2_response object, or 'string' for the raw JSON string.}
    \item{\code{.json_parser}}{A string specifying which parser to use when .return_as = 'list'. Defaults to 'RcppSimdJson' (faster) or 'jsonlite'. Beware that their output may differ slightly.}
    \item{\code{.headers}}{A named list of extra HTTP headers to add to the request. If no 'Accept' header is provided anywhere, 'Accept: \emph{/}' will be sent by default.}
    \item{\code{.auth}}{An authentication token or method (e.g., a bearer token string).}
    \item{\code{.throttle_rate}}{A number to pass to \code{httr2::req_throttle()} to limit the rate of requests. For example, \code{15/60} means 15 requests per minute. This overrides any default rate set at client generation time.}
    \item{\code{.build_only}}{A logical. If TRUE, the function will build and return the httr2_request object without performing it. Defaults to FALSE.}
    \item{\code{.server}}{A string to override the base URL for this specific request. If provided, it will be used instead of the default server URL.}
    \item{\code{.referer}}{A string to set the Referer HTTP header.}
    \item{\code{.req_options}}{A named list of curl options passed to \code{httr2::req_options()}. Useful for timeouts, proxies, SSL, etc.}
    \item{\code{.handle_response}}{A function taking an \code{httr2_response} and returning a value. If supplied, it overrides \code{.return_as} / \code{.json_parser} handling. See helpers like \code{oa3_content_or_stop()}.}
    \item{\code{.json_auto_unbox}}{Logical. If TRUE, JSON bodies are encoded with \code{auto_unbox = TRUE} (jsonlite). Defaults to FALSE unless overridden.}
    \item{\code{.paginate}}{A logical, character string, or function to enable pagination. If TRUE (or "link_header"), uses Link headers. Other options: "page_param", "cursor_param", or a custom function. See \code{oa3_paginate()}.}
  }}

\item{output}{The desired output format. One of:
\itemize{
\item \code{"itineraries"} (default): An \code{sf} data frame of paired itineraries.
\item \code{"legs"}: An \code{sf} data frame of individual journey legs for paired journeys.
\item \code{"travel_time_matrix_long"}: A long-format data frame with travel times
from all origins to all destinations.
\item \code{"travel_time_matrix_wide"}: A wide-format data frame (matrix) with
travel times from all origins to all destinations.
\item \code{"raw_list"}: The raw parsed JSON response as a list.
}}

\item{parallel}{Logical. If \code{TRUE}, executes multiple requests in parallel.
Defaults to \code{FALSE}.}
}
\value{
Depending on the \code{output} parameter, an \code{sf} data frame, a regular
data frame, or a list.
}
\description{
This function is a user-friendly wrapper around the MOTIS \code{plan} API.
It can plan paired journeys (\code{from[1]} to \code{to[1]}, etc.) or compute a
full travel time matrix (from all origins to all destinations).
}
